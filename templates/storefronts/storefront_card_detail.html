{% extends "base.html" %}

{# Keep consistent spacing like other pages (no watermark) #}
{% block main_class %}page-container{% endblock %}

{% block content %}
  <div class="mk-card-detail">

    <p class="mk-card-detail__top">
      <a class="mk-card-detail__back" href="{% url 'storefront_detail' storefront.slug %}">‚Üê Back to storefront</a>
    </p>

    <section class="mk-card-detail__panel">
      <div class="mk-card-detail__grid">

        <div class="mk-card-detail__media">
          {% if card.image_url %}
            <div class="mk-card-detail__imgwrap">
              <img
                src="{{ card.image_url }}"
                alt="{{ card.title|default:'Digital card' }}"
                class="mk-card-detail__img"
                loading="lazy"
              >
            </div>
          {% else %}
            <div class="mk-card-detail__imgwrap mk-card-detail__imgwrap--empty">
              <p class="mb-0">No image available.</p>
            </div>
          {% endif %}
        </div>

        <div class="mk-card-detail__info">
          <h1 class="mk-card-detail__title">{{ card.title|default:"Digital card" }}</h1>

          {% if card.price_label %}
            <p class="mk-card-detail__price">{{ card.price_label }}</p>
          {% endif %}

          {% if card.description %}
            <div class="mk-card-detail__desc" id="mk-card-desc">
              {{ card.description|linebreaksbr }}
            </div>

            <button
              type="button"
              class="mk-card-detail__desc-toggle"
              id="mk-card-desc-toggle"
              hidden
            >
              Read more
            </button>
          {% endif %}

          <div class="mk-card-detail__actions">
            {% if card.buy_url %}
              <a
                class="btn btn-primary btn-sm"
                href="{{ card.buy_url }}"
                target="_blank"
                rel="noopener noreferrer"
              >
                Buy / details
              </a>
            {% else %}
              <button class="btn btn-primary btn-sm" type="button" disabled title="Add a Buy / details link in Hub">
                Buy / details
              </button>
              <p class="mk-card-detail__hint mb-0">
                Storefront owner has not added a buy link yet.
              </p>
            {% endif %}
          </div>
        </div>

      </div>
    </section>
  </div>

  <script>
    (function () {
      const desc = document.getElementById("mk-card-desc");
      const toggle = document.getElementById("mk-card-desc-toggle");
      if (!desc || !toggle) return;

      // If clamped content does not overflow, hide the toggle completely
      const needsToggle = desc.scrollHeight > desc.clientHeight + 2;
      if (!needsToggle) return;

      toggle.hidden = false;

      toggle.addEventListener("click", function () {
        const expanded = desc.classList.toggle("is-expanded");
        toggle.textContent = expanded ? "Show less" : "Read more";
      });
    })();
  </script>
{% endblock %}
