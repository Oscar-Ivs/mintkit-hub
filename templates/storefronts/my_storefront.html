{% extends "base.html" %}

{% block content %}

<header class="sf-header">
  <div class="sf-header-main">
    <h1>My storefront</h1>
    <p class="text-muted">
      This is your public-facing page. Preview how it looks and update the details below.
    </p>
  </div>

  <div class="sf-header-actions">
    {% if storefront.is_active %}
    <span class="sf-badge sf-badge-success">Listed in Explore</span>
    {% else %}
    <span class="sf-badge sf-badge-muted">Hidden from Explore</span>
    {% endif %}

    <a href="{{ public_url }}" target="_blank" rel="noopener" class="btn btn-primary">
      View public storefront
    </a>
  </div>
</header>

<div class="sf-grid">
  <!-- LEFT: PREVIEW -->
  <section class="sf-panel sf-panel-preview">
    <h2>Preview</h2>

    <div class="sf-preview-card">
      <div class="sf-preview-logo">
        {% if storefront.logo %}
        <img src="{{ storefront.logo.url }}" alt="{{ storefront.headline }} logo" class="storefront-logo-large">
        {% endif %}

      </div>

      <h3 class="sf-preview-headline">
        {{ storefront.headline|default:"Your storefront headline" }}
      </h3>

      <p class="sf-preview-body">
        {{ storefront.description|default:"Add a short description of your service or products." }}
      </p>

      <h4 class="sf-preview-section-title">Contact details</h4>
      <p class="sf-preview-body">
        {{ storefront.contact_details|default:"Add contact details customers can use to find or reach you." }}
      </p>
    </div>

    {% if storefront.cards.exists %}
    <h3 class="storefront-section-heading">Featured digital cards</h3>

    <div class="sf-card-grid">
      {% for card in storefront.cards.all %}
      <article class="sf-card">
        <div class="sf-card-image-wrap">
          <img src="{{ card.image_url }}" alt="{{ card.title }}">
        </div>

        <div class="sf-card-body">
          <h4 class="sf-card-title">
            {{ card.title }}
            {% if card.price_label %}
            <span class="sf-card-price">{{ card.price_label }}</span>
            {% endif %}
          </h4>

          {% if card.description %}
          <p class="sf-card-text">{{ card.description }}</p>
          {% endif %}

          {% if card.buy_url %}
          <a href="{{ card.buy_url }}" class="btn btn-sm btn-primary" target="_blank" rel="noopener">
            Buy now
          </a>
          {% endif %}
        </div>
      </article>
      {% endfor %}
    </div>
    {% endif %}

    <p class="text-muted sf-preview-url">
      Customers will see this page at
      <a href="{{ public_url }}">{{ public_url }}</a>.
    </p>
  </section>

  <!-- RIGHT: EDIT FORM -->
  <section class="sf-panel">
    <h2>Edit storefront details</h2>
    <p class="text-muted">
      Update the text shown on your public page. You can toggle public visibility here as well.
    </p>

    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      {{ form.non_field_errors }}

      <!-- Storefront logo upload -->
      <div class="sf-form-row sf-logo-row">
        <label for="{{ form.logo.id_for_label }}">Storefront logo:</label>

        {% if storefront.logo %}
        <div class="sf-logo-current">
          <img src="{{ storefront.logo.url }}" alt="{{ storefront.headline|default:'Storefront logo' }}">
          <div class="sf-form-help">
            This logo appears above the preview on the left and on your public page.
            <p class="text-muted small">
              To change your logo, upload a new file and click <em>Save storefront</em>.
              If you leave this field empty, your current logo will stay the same.
            </p>

          </div>
        </div>
        {% endif %}

        {{ form.logo }}
      </div>
      <h3 class="storefront-section-heading mt-4">Featured digital cards</h3>
      <p class="text-muted">
        Add up to three MintKit cards to highlight on your storefront.
        Paste the <code>thumbnail.webp</code> image URL and the link customers should use to buy.
      </p>

      <div class="sf-card-formset">
        {{ card_formset.management_form }}

        {% for card_form in card_formset %}
        <div class="sf-card-form">
          <h4 class="sf-card-form-title">Card {{ forloop.counter }}</h4>

          <div class="form-row">
            <label for="{{ card_form.title.id_for_label }}">Card title</label>
            {{ card_form.title }}
          </div>

          <div class="form-row sf-card-two-col">
            <div>
              <label for="{{ card_form.price_label.id_for_label }}">Price label (optional)</label>
              {{ card_form.price_label }}
            </div>
            <div>
              <label for="{{ card_form.buy_url.id_for_label }}">Buy / details link</label>
              {{ card_form.buy_url }}
            </div>
          </div>

          <div class="form-row">
            <label for="{{ card_form.image_url.id_for_label }}">Thumbnail image URL</label>
            {{ card_form.image_url }}
            <p class="text-muted small">
              Example: <code>https://.../Test123/.../thumbnail.webp</code>
            </p>
          </div>

          <div class="form-row">
            <label for="{{ card_form.description.id_for_label }}">Short description (optional)</label>
            {{ card_form.description }}
          </div>

          {% if card_form.DELETE %}
          <div class="form-row sf-card-delete-row">
            <label class="checkbox-inline">
              {{ card_form.DELETE }} Remove this card
            </label>
          </div>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      <div class="sf-form-row">
        <label for="{{ form.headline.id_for_label }}">Storefront headline:</label>
        {{ form.headline }}
        <div class="sf-form-help">
          Shown as the main title of your storefront.
        </div>
      </div>

      <div class="sf-form-row">
        <label for="{{ form.description.id_for_label }}">Description:</label>
        {{ form.description }}
        <div class="sf-form-help">
          Appears as the main body text on your storefront page.
        </div>
      </div>

      <div class="sf-form-row">
        <label for="{{ form.contact_details.id_for_label }}">Contact details:</label>
        {{ form.contact_details }}
        <div class="sf-form-help">
          These details help customers contact or find you.
        </div>
      </div>

      <div class="sf-form-row">
        <div class="sf-form-inline">
          <label class="sf-checkbox-label">
            {{ form.is_active }}
            <span>Make my storefront public</span>
          </label>
        </div>
        <div class="sf-form-help">
          Tick this when you're ready for customers to see your page (and list it in Explore).
        </div>
      </div>

      <button type="submit" class="btn btn-primary">
        Save storefront
      </button>
    </form>
  </section>
</div>

{% endblock %}