{% extends "base.html" %}

{% block content %}
<h1>Dashboard</h1>

<p>Welcome, {{ request.user.first_name|default:request.user.username }}.</p>

{# -------------------- Business profile -------------------- #}
<h2>Your business profile</h2>
<ul>
    <li>
        <strong>Business name:</strong>
        {{ profile.business_name|default:"Not set yet" }}
    </li>
    <li>
        <strong>Contact email:</strong>
        {{ profile.contact_email|default:"Not set yet" }}
    </li>
    <li>
        <strong>Member since:</strong>
        {{ profile.user.date_joined|date:"Y-m-d H:i" }}
    </li>
</ul>

<p>
    <a href="{% url 'edit_profile' %}">Edit business profile</a>
</p>

{# -------------------- Subscription / trial info -------------------- #}
<h2>Your subscription</h2>

{% if subscription %}
    <p><strong>Plan:</strong> {{ subscription.plan.name }}</p>

    {% if subscription.status == "trial" %}
        <p>
            Status: Free trial
            {% if subscription.current_period_end %}
                - ends on
                {{ subscription.current_period_end|date:"F j, Y" }}.
            {% endif %}
        </p>
    {% else %}
        <p>
            Status: Active {{ subscription.plan.name }} subscription.
        </p>
    {% endif %}

    {# Later we can show limits (batches, cards) from subscription.plan here #}

{% else %}
    <p>
        You don't have a subscription yet. You're currently on the default
        free tier.
    </p>
    <p>
        <a href="{% url 'pricing' %}">View pricing &amp; start a free trial →</a>
    </p>
{% endif %}

{# -------------------- Storefront block -------------------- #}
<h2>Your storefront</h2>

{% if storefront %}
    <p>
        Status:
        {% if storefront.is_active %}
            <strong>Active</strong>
        {% else %}
            <strong>Inactive</strong>
        {% endif %}
    </p>

    <p>
        Public URL:
        {% if storefront.slug %}
            {# Use the URL tag instead of calling request.build_absolute_uri(...) #}
            <a href="{% url 'storefront_detail' storefront.slug %}">
                {% url 'storefront_detail' storefront.slug %}
            </a>
        {% else %}
            Not set yet.
        {% endif %}
    </p>

    <p>
        <a href="{% url 'my_storefront' %}">Manage my storefront →</a>
    </p>
{% else %}
    <p>
        You have not created a storefront yet.
    </p>
    <p>
        <a href="{% url 'my_storefront' %}">Create my storefront →</a>
    </p>
{% endif %}


{% endblock %}
