{% extends "base.html" %}

{% block content %}

<header class="sf-header">
  <div class="sf-header-main">
    <h1>Dashboard</h1>
    <p class="text-muted">
      Quick overview of your business profile, subscription and storefront.
    </p>
  </div>

  <div class="sf-header-actions">
    <a href="{% url 'studio' %}" class="btn btn-primary">
      Open MintKit Studio
    </a>
  </div>
</header>

<div class="sf-grid">
  <!-- LEFT: business profile + subscription -->
  <section class="sf-panel">
    <h2>Your business profile</h2>

    <p>
      Welcome,
      <strong>{{ request.user.first_name|default:request.user.username }}</strong>.
    </p>

    <ul>
      <li>
        <strong>Business name:</strong>
        {{ profile.business_name|default:"Not set yet" }}
      </li>
      <li>
        <strong>Contact email:</strong>
        {{ profile.contact_email|default:"Not set yet" }}
      </li>
      <li>
        <strong>Member since:</strong>
        {{ profile.user.date_joined|date:"Y-m-d H:i" }}
      </li>
    </ul>

    <p>
      <a href="{% url 'edit_profile' %}" class="btn btn-primary">
        Edit business profile
      </a>
    </p>

    <hr>

    <h2>Your subscription</h2>

    {% if subscription %}
      <p><strong>Plan:</strong> {{ subscription.plan.name }}</p>

      {% if subscription.status == "trial" %}
        <p>
          Status: Free trial
          {% if subscription.current_period_end %}
            – ends on {{ subscription.current_period_end|date:"F j, Y" }}.
          {% endif %}
        </p>
      {% else %}
        <p>
          Status: Active {{ subscription.plan.name }} subscription.
        </p>
      {% endif %}

      {# Later: show simple usage / limits here #}

    {% else %}
      <p>
        You don't have a subscription yet. You're currently on the default
        free tier.
      </p>
      <p>
        <a href="{% url 'pricing' %}">View pricing &amp; start a free trial →</a>
      </p>
    {% endif %}
  </section>

  <!-- RIGHT: storefront status + next steps -->
  <section class="sf-panel">
    <h2>Your storefront</h2>

    {% if storefront %}
      <p>
        <strong>Status:</strong>
        {% if storefront.is_active %}
          <span class="sf-badge sf-badge-success">Active / public</span>
        {% else %}
          <span class="sf-badge sf-badge-muted">Hidden (not public yet)</span>
        {% endif %}
      </p>

      <p>
        <strong>Public URL:</strong>
        {% if storefront.slug %}
          <a href="{% url 'storefront_detail' storefront.slug %}" target="_blank" rel="noopener">
            {% url 'storefront_detail' storefront.slug %}
          </a>
        {% else %}
          Not set yet.
        {% endif %}
      </p>

      <p>
        <a href="{% url 'my_storefront' %}" class="btn btn-primary">
          Manage my storefront
        </a>
      </p>

    {% else %}
      <p>
        You haven't created a storefront yet.
      </p>
      <p>
        <a href="{% url 'my_storefront' %}" class="btn btn-primary">
          Create my first storefront
        </a>
      </p>
    {% endif %}

    <hr>

    <h3>Next steps</h3>
    <ul class="text-muted">
      <li>Check your business profile details are correct.</li>
      <li>Create or refine your storefront text and logo.</li>
      <li>Start a trial or plan so you can mint and manage cards in Studio.</li>
    </ul>
  </section>
</div>

{% endblock %}
